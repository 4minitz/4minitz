sudo: required
language: node_js

env:
  - TEST_FILES=tests/end2end/A* tests/end2end/I* tests/end2end/L*
  - TEST_FILES=tests/end2end/Mee*
  - TEST_FILES=tests/end2end/Mi*
  - TEST_FILES=tests/end2end/R* tests/end2end/S* tests/end2end/T*

addons:
  artifacts:
    # This uploads all headless screenshots generated with:
    #   browser.saveScreenshot("my-testcase");
    # to our Amazon AWS S3 account.
    # After build run completed, you can view the snapshots here:
    # http://s3files.4minitz.com/4minitz/4minitz
    debug: true
    s3_region: "us-west-2" # defaults to "us-east-1"
    paths:
    - $(ls ./tests/snapshots/* | tr "\n" ":")

#cache:
#  directories:
#    - node_modules
#    - .meteor
#    - ~/.meteor
#    - $(npm config get prefix)/bin/chimp

node_js:
  - "stable"

before_install:
  - mkdir ./tests/snapshots
  - curl https://install.meteor.com | /bin/sh
  - npm install -g chimp@0.34.1

before_script:
  - meteor npm run test:end2end:server&
  - sleep 30

script: npm run test:ci
